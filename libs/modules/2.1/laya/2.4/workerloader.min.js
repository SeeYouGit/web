"use strict";var createImageBitmapOK=!!self.createImageBitmap;onmessage=function(e){loadImage2(e.data),isSet||(isSet=!0,setInterval(workerloop,1e3))};var isSet=!0;function workerloop(){myTrace("png:workerloop")}var enableTrace=!1,ifShowTraceToMain=!1;function myTrace(e){enableTrace&&(console.log("png:"+e),ifShowTraceToMain&&showMsgToMain(e))}function loadImage2(e){var a,t=!1;(a=new XMLHttpRequest).open("GET",e,!0),a.responseType="arraybuffer",myTrace("load:"+e),a.onload=function(){var o=a.response||a.mozResponseArrayBuffer;(myTrace("onload:"+e),200!=a.status&&0!=a.status||o.byteLength<10)?t||(t=!0,pngFail(e,"loadFail from onload"+a.status)):doCreateImageBitmap(new Uint8Array(o),e)},a.onerror=function(a){pngFail(e,"loadFail")},a.send(null)}function doCreateImageBitmap(e,a){try{var t=getTimeNow();e=new self.Blob([e],{type:"image/png"}),self.createImageBitmap(e).then(function(e){var o={};o.url=a,o.imageBitmap=e,o.dataType="imageBitmap",o.startTime=t,o.decodeTime=getTimeNow()-t,o.sendTime=getTimeNow(),myTrace("png:Decode By createImageBitmap,"+o.decodeTime,a),o.type="Image",postMessage(o,[o.imageBitmap])}).catch(function(e){showMsgToMain("catch e:"+e),pngFail(a,"parse fail"+e+":ya")})}catch(e){pngFail(a,"parse fail"+e.toString()+":ya")}}function getTimeNow(){return(new Date).getTime()}function disableWorker(e){var a={};a.url=url,a.imagedata=null,a.type="Disable",a.msg=e,postMessage(a)}function pngFail(e,a){var t={};t.url=e,t.imagedata=null,t.type="Image",t.msg=a,console.log("png:"+a+" "+e),postMessage(t)}function showMsgToMain(e){var a={type:"Msg"};a.msg=e,postMessage(a)}