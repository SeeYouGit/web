"use strict";var _set=function t(e,i,s,n){var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var l=Object.getPrototypeOf(e);null!==l&&t(l,i,s,n)}else if("value"in r&&r.writable)r.value=s;else{var a=r.set;void 0!==a&&a.call(n,s)}return s},_get=function t(e,i,s){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,s)}if("value"in n)return n.value;var l=n.get;return void 0!==l?l.call(s):void 0},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){var i=function(){function t(){_classCallCheck(this,t),this.reset()}return _createClass(t,[{key:"reset",value:function(){return this.stroke=0,this.strokeColor="#000000",this.leading=0,this.lineHeight=0,this.letterSpacing=0,this.href=null,this}},{key:"recover",value:function(){this!=t.EMPTY&&e.Pool.recover("HTMLExtendStyle",this.reset())}}],[{key:"create",value:function(){return e.Pool.getItemByClass("HTMLExtendStyle",t)}}]),t}();i.EMPTY=new i,e.ClassUtils.regClass("laya.html.utils.HTMLExtendStyle",i),e.ClassUtils.regClass("Laya.HTMLExtendStyle",i);var s=function(){function t(){_classCallCheck(this,t),this.padding=t._PADDING,this.reset()}return _createClass(t,[{key:"_getExtendStyle",value:function(){return this._extendStyle===i.EMPTY&&(this._extendStyle=i.create()),this._extendStyle}},{key:"reset",value:function(){return this.ower=null,this._type=0,this.wordWrap=!0,this.fontSize=e.ILaya.Text.defaultFontSize,this.family=e.ILaya.Text.defaultFont,this.color="#000000",this.valign=t.VALIGN_TOP,this.padding=t._PADDING,this.bold=!1,this.italic=!1,this.align=t.ALIGN_LEFT,this.textDecoration=null,this.bgColor=null,this.borderColor=null,this._extendStyle&&this._extendStyle.recover(),this._extendStyle=i.EMPTY,this}},{key:"recover",value:function(){e.Pool.recover("HTMLStyle",this.reset())}},{key:"inherit",value:function(e){var i,s,n,r;for(s=(n=t._inheritProps).length,i=0;i<s;i++)this[r=n[i]]=e[r]}},{key:"_widthAuto",value:function(){return 0!=(this._type&t._WIDTHAUTO)}},{key:"widthed",value:function(e){return 0!=(this._type&t._WIDTH_SET)}},{key:"_calculation",value:function(t,e){return!1}},{key:"heighted",value:function(e){return 0!=(this._type&t._HEIGHT_SET)}},{key:"size",value:function(e,i){var s=this.ower,n=!1;-1!==e&&e!=s.width&&(this._type|=t._WIDTH_SET,s.width=e,n=!0),-1!==i&&i!=s.height&&(this._type|=t._HEIGHT_SET,s.height=i,n=!0),n&&s._layoutLater()}},{key:"getLineElement",value:function(){return 0!=(this._type&t._LINE_ELEMENT)}},{key:"setLineElement",value:function(e){e?this._type|=t._LINE_ELEMENT:this._type&=~t._LINE_ELEMENT}},{key:"_enableLayout",value:function(){return 0==(this._type&t._DISPLAY_NONE)&&0==(this._type&t._ABSOLUTE)}},{key:"cssText",value:function(e){this.attrs(t.parseOneCSS(e,";"))}},{key:"attrs",value:function(t){if(t)for(var e=0,i=t.length;e<i;e++){var s=t[e];this[s[0]]=s[1]}}},{key:"href",get:function(){return this._extendStyle.href},set:function(t){t!==this._extendStyle.href&&(this._getExtendStyle().href=t)}},{key:"stroke",get:function(){return this._extendStyle.stroke},set:function(t){this._extendStyle.stroke!==t&&(this._getExtendStyle().stroke=t)}},{key:"strokeColor",get:function(){return this._extendStyle.strokeColor},set:function(t){this._extendStyle.strokeColor!==t&&(this._getExtendStyle().strokeColor=t)}},{key:"leading",get:function(){return this._extendStyle.leading},set:function(t){this._extendStyle.leading!==t&&(this._getExtendStyle().leading=t)}},{key:"lineHeight",get:function(){return this._extendStyle.lineHeight},set:function(t){this._extendStyle.lineHeight!==t&&(this._getExtendStyle().lineHeight=t)}},{key:"align",set:function(e){e in t.alignVDic&&(this._type&=~t._ALIGN,this._type|=t.alignVDic[e])},get:function(){var e=this._type&t._ALIGN;return t.align_Value[e]}},{key:"valign",set:function(e){e in t.alignVDic&&(this._type&=~t._VALIGN,this._type|=t.alignVDic[e])},get:function(){var e=this._type&t._VALIGN;return t.vAlign_Value[e]}},{key:"font",set:function(t){for(var e=t.split(" "),i=0,s=e.length;i<s;i++){var n=e[i];switch(n){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}n.indexOf("px")>0&&(this.fontSize=parseInt(n),this.family=e[i+1],i++)}},get:function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(e.ILaya.Browser.onIPhone&&e.ILaya.Text.fontFamilyMap[this.family]||this.family)}},{key:"block",set:function(e){e?this._type|=t._CSS_BLOCK:this._type&=~t._CSS_BLOCK},get:function(){return 0!=(this._type&t._CSS_BLOCK)}},{key:"wordWrap",get:function(){return 0==(this._type&t._NOWARP)},set:function(e){e?this._type&=~t._NOWARP:this._type|=t._NOWARP}},{key:"bold",get:function(){return 0!=(this._type&t._BOLD)},set:function(e){e?this._type|=t._BOLD:this._type&=~t._BOLD}},{key:"italic",get:function(){return 0!=(this._type&t._ITALIC)},set:function(e){e?this._type|=t._ITALIC:this._type&=~t._ITALIC}},{key:"whiteSpace",set:function(e){"nowrap"===e&&(this._type|=t._NOWARP),"none"===e&&(this._type&=~t._NOWARP)},get:function(){return this._type&t._NOWARP?"nowrap":""}},{key:"width",set:function(e){if(this._type|=t._WIDTH_SET,"string"==typeof e){var i=e.indexOf("auto");if(i>=0&&(this._type|=t._WIDTHAUTO,e=e.substr(0,i)),this._calculation("width",e))return;e=parseInt(e)}this.size(e,-1)}},{key:"height",set:function(e){if(this._type|=t._HEIGHT_SET,"string"==typeof e){if(this._calculation("height",e))return;e=parseInt(e)}this.size(-1,e)}},{key:"letterSpacing",get:function(){return this._extendStyle.letterSpacing},set:function(t){"string"==typeof t&&(t=parseInt(t+"")),t!=this._extendStyle.letterSpacing&&(this._getExtendStyle().letterSpacing=t)}},{key:"position",set:function(e){"absolute"===e?this._type|=t._ABSOLUTE:this._type&=~t._ABSOLUTE},get:function(){return this._type&t._ABSOLUTE?"absolute":""}},{key:"absolute",get:function(){return 0!=(this._type&t._ABSOLUTE)}},{key:"paddingLeft",get:function(){return this.padding[3]}},{key:"paddingTop",get:function(){return this.padding[0]}}],[{key:"create",value:function(){return e.Pool.getItemByClass("HTMLStyle",t)}},{key:"parseOneCSS",value:function(e,i){for(var s,n=[],r=e.split(i),l=0,a=r.length;l<a;l++){var h=r[l],o=h.indexOf(":"),u=h.substr(0,o).replace(/^\s+|\s+$/g,"");if(0!==u.length){var c=h.substr(o+1).replace(/^\s+|\s+$/g,""),_=[u,c];switch(u){case"italic":case"bold":_[1]="true"==c;break;case"font-weight":"bold"==c&&(_[1]=!0,_[0]="bold");break;case"line-height":_[0]="lineHeight",_[1]=parseInt(c);break;case"font-size":_[0]="fontSize",_[1]=parseInt(c);break;case"stroke":_[0]="stroke",_[1]=parseInt(c);break;case"padding":(s=c.split(" ")).length>1||(s[1]=s[2]=s[3]=s[0]),_[1]=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];break;default:(_[0]=t._CSSTOVALUE[u])||(_[0]=u)}n.push(_)}}return n}},{key:"parseCSS",value:function(e,i){for(var s;null!=(s=t._parseCSSRegExp.exec(e));)t.styleSheets[s[1]]=t.parseOneCSS(s[2],";")}}]),t}();s._CSSTOVALUE={"letter-spacing":"letterSpacing","white-space":"whiteSpace","line-height":"lineHeight","font-family":"family","vertical-align":"valign","text-decoration":"textDecoration","background-color":"bgColor","border-color":"borderColor"},s._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),s._inheritProps=["italic","align","valign","leading","stroke","strokeColor","bold","fontSize","lineHeight","wordWrap","color"],s.ALIGN_LEFT="left",s.ALIGN_CENTER="center",s.ALIGN_RIGHT="right",s.VALIGN_TOP="top",s.VALIGN_MIDDLE="middle",s.VALIGN_BOTTOM="bottom",s.styleSheets={},s.ADDLAYOUTED=512,s._PADDING=[0,0,0,0],s._HEIGHT_SET=8192,s._LINE_ELEMENT=65536,s._NOWARP=131072,s._WIDTHAUTO=262144,s._BOLD=1024,s._ITALIC=2048,s._CSS_BLOCK=1,s._DISPLAY_NONE=2,s._ABSOLUTE=4,s._WIDTH_SET=8,s.alignVDic={left:0,center:16,right:32,top:0,middle:64,bottom:128},s.align_Value={0:"left",16:"center",32:"right"},s.vAlign_Value={0:"top",64:"middle",128:"bottom"},s._ALIGN=48,s._VALIGN=192,e.ClassUtils.regClass("laya.html.utils.HTMLStyle",s),e.ClassUtils.regClass("Laya.HTMLStyle",s);var n=function(){function t(){_classCallCheck(this,t),this.all=[],this.styleSheets=s.styleSheets}return _createClass(t,[{key:"getElementById",value:function(t){return this.all[t]}},{key:"setElementById",value:function(t,e){this.all[t]=e}}]),t}();n.document=new n,e.ClassUtils.regClass("laya.html.dom.HTMLDocument",n),e.ClassUtils.regClass("Laya.HTMLDocument",n);var r=function(){function t(){_classCallCheck(this,t),this.rec=new e.Rectangle,this.reset()}return _createClass(t,[{key:"reset",value:function(){return this.rec.reset(),this.href=null,this}},{key:"recover",value:function(){e.Pool.recover("HTMLHitRect",this.reset())}}],[{key:"create",value:function(){return e.Pool.getItemByClass("HTMLHitRect",t)}}]),t}();e.ClassUtils.regClass("laya.html.dom.HTMLHitRect",r),e.ClassUtils.regClass("Laya.HTMLHitRect",r);var l=function t(){_classCallCheck(this,t)};l.HTMLDivElement=null,l.HTMLImageElement=null,l.HTMLBrElement=null,l.HTMLDivParser=null,l.HTMLParse=null,l.HTMLElementType=null;var a=function(){function t(){_classCallCheck(this,t),this.elements=[],this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0}return _createClass(t,[{key:"updatePos",value:function(t,e,i,n,r,a,h){var o,u=0;this.elements.length>0&&(u=(o=this.elements[this.elements.length-1]).x+o.width-this.elements[0].x),h=h||this.h;var c,_=0;r===s.ALIGN_CENTER&&(_=(e-u)/2),r===s.ALIGN_RIGHT&&(_=e-u);for(var y=0,d=this.elements.length;y<d;y++){var f=(o=this.elements[y])._getCSSStyle();switch(0!==_&&(o.x+=_),f.valign){case"top":o.y=n;break;case"middle":var p=0;99999!=this.minTextHeight&&(p=this.minTextHeight);var g=(p+h)/2;g=Math.max(g,this.h),c=(o.eletype,l.HTMLElementType.IMAGE,n+g-o.height),o.y=c;break;case"bottom":o.y=n+(h-o.height)}}}}]),t}();e.ClassUtils.regClass("laya.html.utils.LayoutLine",a),e.ClassUtils.regClass("Laya.LayoutLine",a);var h,o=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"later",value:function(i){null==t._will&&(t._will=[],e.ILaya.stage.frameLoop(1,null,function(){if(!(t._will.length<1)){for(var e=0;e<t._will.length;e++)t.layout(t._will[e]);t._will.length=0}})),t._will.push(i)}},{key:"layout",value:function(e){return e&&e._style?0==(e._style._type&s.ADDLAYOUTED)?null:(e.style._type&=~s.ADDLAYOUTED,t._multiLineLayout(e)):null}},{key:"_multiLineLayout",value:function(e){var i=[];e._addChildsToLayout(i);var n,r,h,o,u,c,_,y=i.length,d=e._getCSSStyle(),f=d.letterSpacing,p=d.leading,g=d.lineHeight,L=d._widthAuto()||!d.wordWrap,v=L?999999:e.width,C=(e.height,0),T=d.italic?d.fontSize/3:0,m=d.align,k=d.valign,E=k!==s.VALIGN_TOP||m!==s.ALIGN_LEFT||0!=g,S=0,x=0,w=0,I=0,H=[],b=H[0]=new a,M=!1;b.h=0,d.italic&&(v-=d.fontSize/3);var O=0,U=!0;function P(){b.y=x,x+=b.h+p,b.mWidth=O,O=0,b=new a,H.push(b),b.h=0,S=0,U=!0,u=!1}for(n=0;n<y;n++)if(null!=(r=i[n]))if(U=!1,r instanceof l.HTMLBrElement)P(),b.y=x,b.h=g;else{if(r._isChar()){if((c=r).isWord)u=M||"\n"===c.char,b.wordStartIndex=b.elements.length;else{if(H.length>0&&S+w>v&&b.wordStartIndex>0){var A;A=b.elements.length-b.wordStartIndex+1,b.elements.length=b.wordStartIndex,n-=A,P();continue}u=!1,O+=c.width}w=c.width+c.style.letterSpacing,I=c.height,M=!1,(u=u||S+w>v)&&P(),b.minTextHeight=Math.min(b.minTextHeight,r.height)}else _=r,o=(h=r._getCSSStyle()).padding,u=M||h.getLineElement(),w=_.width+o[1]+o[3]+h.letterSpacing,I=_.height+o[0]+o[2],M=h.getLineElement(),(u=u||S+w>v&&h.wordWrap)&&P();b.elements.push(r),b.h=Math.max(b.h,I),r.x=S,r.y=x,S+=w,b.w=S-f,b.y=x,C=Math.max(S+T,C)}else U||(S+=t.DIV_ELEMENT_PADDING),b.wordStartIndex=b.elements.length;if(x=b.y+b.h,E){var D=0,R=v;for(L&&e.width>0&&(R=e.width),n=0,y=H.length;n<y;n++)H[n].updatePos(0,R,n,D,m,k,g),D+=Math.max(g,H[n].h+p);x=D}return L&&(e.width=C),x>e.height&&(e.height=x),[C,x]}}]),t}();o.DIV_ELEMENT_PADDING=0,e.ClassUtils.regClass("laya.html.utils.Layout",o),e.ClassUtils.regClass("Laya.Layout",o),(h=t.HTMLElementType||(t.HTMLElementType={}))[h.BASE=0]="BASE",h[h.IMAGE=1]="IMAGE";var u=function(){function i(){_classCallCheck(this,i),this.eletype=t.HTMLElementType.BASE,this._creates(),this.reset()}return _createClass(i,[{key:"_creates",value:function(){this._style=s.create()}},{key:"reset",value:function(){if(this.URI=null,this.parent=null,this._style.reset(),this._style.ower=this,this._style.valign="middle",this._text&&this._text.words){var t,e,s,n=this._text.words;for(e=n.length,t=0;t<e;t++)(s=n[t])&&s.recover()}return this._text=i._EMPTYTEXT,this._children&&(this._children.length=0),this._x=this._y=this._width=this._height=0,this}},{key:"_getCSSStyle",value:function(){return this._style}},{key:"_addChildsToLayout",value:function(t){var e=this._getWords();if(null==e&&(!this._children||0==this._children.length))return!1;if(e)for(var i=0,s=e.length;i<s;i++)t.push(e[i]);return this._children&&this._children.forEach(function(e,i,s){var n=e._style;n._enableLayout&&n._enableLayout()&&e._addToLayout(t)}),!0}},{key:"_addToLayout",value:function(t){if(this._style){var e=this._style;e.absolute||(e.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))}}},{key:"repaint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.parentRepaint(t)}},{key:"parentRepaint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.parent&&this.parent.repaint(t)}},{key:"_setParent",value:function(t){if(t instanceof i){var e=t;this.URI||(this.URI=e.URI),this.style&&this.style.inherit(e.style)}}},{key:"appendChild",value:function(t){return this.addChild(t)}},{key:"addChild",value:function(t){return t.parent&&t.parent.removeChild(t),this._children||(this._children=[]),this._children.push(t),t.parent=this,t._setParent(this),this.repaint(),t}},{key:"removeChild",value:function(t){if(!this._children)return null;var e,i;for(i=this._children.length,e=0;e<i;e++)if(this._children[e]==t)return this._children.splice(e,1),t;return null}},{key:"destroy",value:function(){this._children&&(this.destroyChildren(),this._children.length=0),e.Pool.recover(i.getClassName(this),this.reset())}},{key:"destroyChildren",value:function(){if(this._children){for(var t=this._children.length-1;t>-1;t--)this._children[t].destroy();this._children.length=0}}},{key:"_getWords",value:function(){if(!this._text)return null;var t=this._text.text;if(!t||0===t.length)return null;var i,s=this._text.words;if(s&&s.length===t.length)return s;null===s&&(this._text.words=s=[]),s.length=t.length;for(var n=this.style,r=n.font,l=0,a=t.length;l<a;l++)i=e.ILaya.Browser.measureText(t.charAt(l),r),s[l]=e.HTMLChar.create().setData(t.charAt(l),i.width,i.height||n.fontSize,n);return s}},{key:"_isChar",value:function(){return!1}},{key:"_layoutLater",value:function(){var t=this.style;t._type&s.ADDLAYOUTED||(t.widthed(this)&&(this._children&&this._children.length>0||null!=this._getWords())&&t.block?(o.later(this),t._type|=s.ADDLAYOUTED):this.parent&&this.parent._layoutLater())}},{key:"_setAttributes",value:function(t,e){switch(t){case"style":this.style.cssText(e);break;case"class":this.className=e;break;case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}}},{key:"formatURL",value:function(t){return this.URI?i.formatURL1(t,this.URI?this.URI.path:null):t}},{key:"drawToGraphic",value:function(t,e,i,s){e+=this.x,i+=this.y;var n,r,l,a=this.style;if(a.paddingLeft&&(e+=a.paddingLeft),a.paddingTop&&(i+=a.paddingTop),(null!=a.bgColor||a.borderColor)&&t.drawRect(e,i,this.width,this.height,a.bgColor,a.borderColor,1),this.renderSelfToGraphic(t,e,i,s),this._children&&this._children.length>0)for(r=this._children.length,n=0;n<r;n++)null!=(l=this._children[n]).drawToGraphic&&l.drawToGraphic(t,e,i,s)}},{key:"renderSelfToGraphic",value:function(t,e,i,s){var n=this.style,l=this._getWords();if(l&&(l.length,n)){var a=n.font,h=n.color;if(n.stroke){var o=n.stroke;o=parseInt(o);var u=n.strokeColor;t.fillBorderWords(l,e,i,a,h,u,o)}else t.fillWords(l,e,i,a,h);if(this.href){var c=l[l.length-1],_=c.y+c.height;if(c.y==l[0].y){"none"!=n.textDecoration&&t.drawLine(l[0].x,_,c.x+c.width,_,h,1);var y=r.create();y.rec.setTo(l[0].x,c.y,c.x+c.width-l[0].x,c.height),y.href=this.href,s.push(y)}else this.workLines(l,t,s)}}}},{key:"workLines",value:function(t,e,i){var s,n,r,l,a;if(s="none"!=this.style.textDecoration,r=t.length,a=l=t[n],l){var h;for(n=1;n<r;n++)(h=t[n]).y!=l.y?(this.createOneLine(l,a,s,e,i),l=h,a=h):a=h;this.createOneLine(l,a,s,e,i)}}},{key:"createOneLine",value:function(t,e,i,s,n){var l=e.y+e.height;i&&s.drawLine(t.x,l,e.x+e.width,l,this.style.color,1);var a=r.create();a.rec.setTo(t.x,e.y,e.x+e.width-t.x,e.height),a.href=this.href,n.push(a)}},{key:"id",set:function(t){n.document.setElementById(t,this)}},{key:"innerTEXT",set:function(t){this._text===i._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),this.repaint()},get:function(){return this._text.text}},{key:"style",get:function(){return this._style}},{key:"x",set:function(t){this._x!=t&&(this._x=t,this.parentRepaint())},get:function(){return this._x}},{key:"y",set:function(t){this._y!=t&&(this._y=t,this.parentRepaint())},get:function(){return this._y}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this.repaint())}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this.repaint())}},{key:"href",set:function(t){this._style&&t!=this._style.href&&(this._style.href=t,this.repaint())},get:function(){return this._style?this._style.href:null}},{key:"color",set:function(t){this.style.color=t}},{key:"className",set:function(t){this.style.attrs(n.document.styleSheets["."+t])}}],[{key:"formatURL1",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t)return"null path";if(i||(i=e.URL.basePath),t.indexOf(":")>0)return t;if(null!=e.URL.customFormat&&(t=e.URL.customFormat(t)),t.indexOf(":")>0)return t;var s=t.charAt(0);if("."===s)return e.URL._formatRelativePath(i+t);if("~"===s)return e.URL.rootPath+t.substring(1);if("d"===s){if(0===t.indexOf("data:image"))return t}else if("/"===s)return t;return i+t}},{key:"getClassName",value:function(t){return t instanceof Function?t.name:t.constructor.name}}]),i}();u._EMPTYTEXT={text:null,words:null},e.ILaya.regClass(u),l.HTMLElementType=t.HTMLElementType,e.ClassUtils.regClass("laya.html.dom.HTMLElement",u),e.ClassUtils.regClass("Laya.HTMLElement",u);var c=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"_addToLayout",value:function(t){t.push(this)}},{key:"reset",value:function(){return this}},{key:"destroy",value:function(){e.Pool.recover(u.getClassName(this),this.reset())}},{key:"_setParent",value:function(t){}},{key:"_getCSSStyle",value:function(){return t.brStyle||(t.brStyle=new s,t.brStyle.setLineElement(!0),t.brStyle.block=!0),t.brStyle}},{key:"renderSelfToGraphic",value:function(t,e,i,s){}},{key:"parent",set:function(t){}},{key:"URI",set:function(t){}},{key:"href",set:function(t){}}]),t}();l.HTMLBrElement=c,e.ILaya.regClass(c),e.ClassUtils.regClass("laya.html.dom.HTMLBrElement",c),e.ClassUtils.regClass("Laya.HTMLBrElement",c);var _=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,u),_createClass(e,[{key:"_creates",value:function(){}},{key:"drawToGraphic",value:function(t,e,i,s){}},{key:"reset",value:function(){return this}},{key:"innerTEXT",set:function(t){s.parseCSS(t,null)},get:function(){return _get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"innerTEXT",this)}}]),e}();e.ILaya.regClass(_),e.ClassUtils.regClass("laya.html.dom.HTMLStyleElement",_),e.ClassUtils.regClass("Laya.HTMLStyleElement",_);var y=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,u),_createClass(i,[{key:"_creates",value:function(){}},{key:"drawToGraphic",value:function(t,e,i,s){}},{key:"reset",value:function(){return this._loader&&this._loader.off(e.Event.COMPLETE,this,this._onload),this._loader=null,this}},{key:"_onload",value:function(t){switch(this._loader&&(this._loader=null),this.type){case"text/css":s.parseCSS(t,this.URI)}this.repaint(!0)}},{key:"href",set:function(t){t&&(t=this.formatURL(t),this.URI=new e.URL(t),this._loader&&this._loader.off(e.Event.COMPLETE,this,this._onload),e.Loader.getRes(t)?"text/css"==this.type&&s.parseCSS(e.Loader.getRes(t),this.URI):(this._loader=new e.Loader,this._loader.once(e.Event.COMPLETE,this,this._onload),this._loader.load(t,e.Loader.TEXT)))},get:function(){return _get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"href",this)}}]),i}();y._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),e.ILaya.regClass(y),e.ClassUtils.regClass("laya.html.dom.HTMLLinkElement",y),e.ClassUtils.regClass("Laya.HTMLLinkElement",y);var d=function(t){function i(){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments));return t.repaintHandler=null,t}return _inherits(i,u),_createClass(i,[{key:"reset",value:function(){return _get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"reset",this).call(this),this._style.block=!0,this._style.setLineElement(!0),this._style.width=200,this._style.height=200,this.repaintHandler=null,this.contextHeight=0,this.contextWidth=0,this}},{key:"appendHTML",value:function(t){l.HTMLParse.parse(this,t,this.URI),this.layout()}},{key:"_addChildsToLayout",value:function(t){var e=this._getWords();if(null==e&&(!this._children||0==this._children.length))return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,s=0,n=this._children.length;s<n;s++){var r=this._children[s];i?i=!1:t.push(null),r._addToLayout(t)}return!0}},{key:"_addToLayout",value:function(t){this.layout(),!this.style.absolute&&t.push(this)}},{key:"getBounds",value:function(){return this._htmlBounds?(this._boundsRec||(this._boundsRec=e.Rectangle.create()),this._boundsRec.copyFrom(this._htmlBounds)):null}},{key:"parentRepaint",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"parentRepaint",this).call(this),this.repaintHandler&&this.repaintHandler.runWith(t)}},{key:"layout",value:function(){this.style._type|=s.ADDLAYOUTED;var t=o.layout(this);if(t){this._htmlBounds||(this._htmlBounds=e.Rectangle.create());var i=this._htmlBounds;i.x=i.y=0,i.width=this.contextWidth=t[0],i.height=this.contextHeight=t[1]}}},{key:"innerHTML",set:function(t){this.destroyChildren(),this.appendHTML(t)}},{key:"width",set:function(t){var e;e=0===t?t!=this._width:t!=this.width,_set(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"width",t,this),e&&this.layout()},get:function(){return this._width?this._width:this.contextWidth}},{key:"height",get:function(){return this._height?this._height:this.contextHeight},set:function(t){_set(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"height",t,this)}}]),i}();l.HTMLDivParser=d,e.ILaya.regClass(d),e.ClassUtils.regClass("laya.html.dom.HTMLDivParser",d),e.ClassUtils.regClass("Laya.HTMLDivParser",d);var f=function(i){function s(){_classCallCheck(this,s);var e=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return e.eletype=t.HTMLElementType.IMAGE,e}return _inherits(s,u),_createClass(s,[{key:"reset",value:function(){return _get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"reset",this).call(this),this._tex&&this._tex.off(e.Event.LOADED,this,this.onloaded),this._tex=null,this._url=null,this}},{key:"onloaded",value:function(){if(this._style){var t=this._style;t.widthed(this)||this._tex.width,t.heighted(this)||this._tex.height;t.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),t.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),this.repaint()}}},{key:"_addToLayout",value:function(t){!this._style.absolute&&t.push(this)}},{key:"renderSelfToGraphic",value:function(t,e,i,s){this._tex&&t.drawImage(this._tex,e,i,this.width||this._tex.width,this.height||this._tex.height)}},{key:"src",set:function(t){if(t=this.formatURL(t),this._url!==t){this._url=t;var i=this._tex=e.Loader.getRes(t);i||(this._tex=i=new e.Texture,i.load(t),e.Loader.cacheTexture(t,i)),i.getIsReady()?this.onloaded():i.once(e.Event.READY,this,this.onloaded)}}}]),s}();l.HTMLImageElement=f,e.ILaya.regClass(f),e.ClassUtils.regClass("laya.html.dom.HTMLImageElement",f),e.ClassUtils.regClass("Laya.HTMLImageElement",f);var p=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getInstance",value:function(i){var s=e.Pool.getItem(t._htmlClassMapShort[i]);return s||(s=e.ClassUtils.getInstance(i)),s}},{key:"parse",value:function(i,s,n){s=(s="<root>"+(s=s.replace(/<br>/g,"<br/>"))+"</root>").replace(t.spacePattern,t.char255);var r=e.Utils.parseXMLFromString(s);t._parseXML(i,r.childNodes[0].childNodes,n)}},{key:"_parseXML",value:function(e,i,s){var n,r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i.join||i.item)for(n=0,r=i.length;n<r;++n)t._parseXML(e,i[n],s,a);else{var h,o;if(3==i.nodeType){var c;if(e instanceof l.HTMLDivParser)null==i.nodeName&&(i.nodeName="#text"),o=i.nodeName.toLowerCase(),(c=i.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(h=t.getInstance(o))&&(e.addChild(h),h.innerTEXT=c.replace(t.char255AndOneSpacePattern," "));else if((c=i.textContent.replace(/^\s+|\s+$/g,"")).length>0){var _=e;if(e instanceof u&&e.innerTEXT&&e.innerTEXT.length>0){var y=t.getInstance("p");y&&(e.addChild(y),_=y)}_.innerTEXT=c.replace(t.char255AndOneSpacePattern," ")}return}if("#comment"==(o=i.nodeName.toLowerCase()))return;if(h=t.getInstance(o)){"p"==o?(e.addChild(t.getInstance("br")),h=e.addChild(h),e.addChild(t.getInstance("br"))):h=e.addChild(h),h.URI=s,h.href=a;var d=i.attributes;if(d&&d.length>0)for(n=0,r=d.length;n<r;++n){var f=d[n],p=f.nodeName,g=f.value;h._setAttributes(p,g)}t._parseXML(h,i.childNodes,s,h.href)}else t._parseXML(e,i.childNodes,s,a)}}}]),t}();p.char255=String.fromCharCode(255),p.spacePattern=/&nbsp;|&#160;/g,p.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),p._htmlClassMapShort={div:d,p:u,img:f,span:u,br:c,style:_,font:u,a:u,"#text":u,link:y},l.HTMLParse=p,e.ClassUtils.regClass("div",d),e.ClassUtils.regClass("p",u),e.ClassUtils.regClass("img",f),e.ClassUtils.regClass("span",u),e.ClassUtils.regClass("br",c),e.ClassUtils.regClass("style",_),e.ClassUtils.regClass("font",u),e.ClassUtils.regClass("a",u),e.ClassUtils.regClass("#text",u),e.ClassUtils.regClass("link",y),e.ClassUtils.regClass("laya.html.utils.HTMLParse",p),e.ClassUtils.regClass("Laya.HTMLParse",p);var g=function(t){function i(){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t._recList=[],t._repaintState=0,t._element=new d,t._element.repaintHandler=new e.Handler(t,t._htmlDivRepaint),t.mouseEnabled=!0,t.on(e.Event.CLICK,t,t._onMouseClick),t}return _inherits(i,e.Sprite),_createClass(i,[{key:"destroy",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._element&&this._element.reset(),this._element=null,this._doClears(),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"destroy",this).call(this,t)}},{key:"_htmlDivRepaint",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._repaintState<2&&(this._repaintState=2):this._repaintState<1&&(this._repaintState=1),this._repaintState>0&&this._setGraphicDirty()}},{key:"_updateGraphicWork",value:function(){switch(this._repaintState){case 1:this._updateGraphic();break;case 2:this._refresh()}}},{key:"_setGraphicDirty",value:function(){this.callLater(this._updateGraphicWork)}},{key:"_doClears",value:function(){if(this._recList){var t,e=this._recList.length;for(t=0;t<e;t++)this._recList[t].recover();this._recList.length=0}}},{key:"_updateGraphic",value:function(){this._doClears(),this.graphics.clear(!0),this._repaintState=0,this._element.drawToGraphic(this.graphics,-this._element.x,-this._element.y,this._recList);var t=this._element.getBounds();t&&this.setSelfBounds(t),this.size(t.width,t.height)}},{key:"_refresh",value:function(){this._repaintState=1,this._innerHTML&&(this._element.innerHTML=this._innerHTML),this._setGraphicDirty()}},{key:"_onMouseClick",value:function(){var t,e,i,s=this.mouseX,n=this.mouseY;for(e=this._recList.length,t=0;t<e;t++)(i=this._recList[t]).rec.contains(s,n)&&this._eventLink(i.href)}},{key:"_eventLink",value:function(t){this.event(e.Event.LINK,[t])}},{key:"style",get:function(){return this._element.style}},{key:"innerHTML",set:function(t){this._innerHTML!=t&&(this._repaintState=1,this._innerHTML=t,this._element.innerHTML=t,this._setGraphicDirty())}},{key:"contextWidth",get:function(){return this._element.contextWidth}},{key:"contextHeight",get:function(){return this._element.contextHeight}}]),i}();l.HTMLDivElement=g,l.HTMLParse=p,e.ClassUtils.regClass("laya.html.dom.HTMLDivElement",g),e.ClassUtils.regClass("Laya.HTMLDivElement",g);var L=function(t){function i(){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t._element._getCSSStyle().valign="middle",t}return _inherits(i,g),_createClass(i,[{key:"href",set:function(t){var i=this;t=this._element.formatURL(t);var s=new e.Loader;s.once(e.Event.COMPLETE,null,function(s){var n=i._element.URI;i._element.URI=new e.URL(t),i.innerHTML=s,!n||(i._element.URI=n)}),s.load(t,e.Loader.TEXT)}}]),i}();e.ClassUtils.regClass("laya.html.dom.HTMLIframeElement",L),e.ClassUtils.regClass("Laya.HTMLIframeElement",L),t.HTMLBrElement=c,t.HTMLDivElement=g,t.HTMLDivParser=d,t.HTMLDocument=n,t.HTMLElement=u,t.HTMLExtendStyle=i,t.HTMLHitRect=r,t.HTMLIframeElement=L,t.HTMLImageElement=f,t.HTMLLinkElement=y,t.HTMLParse=p,t.HTMLStyle=s,t.HTMLStyleElement=_,t.IHtml=l,t.Layout=o,t.LayoutLine=a}(window.Laya=window.Laya||{},Laya);