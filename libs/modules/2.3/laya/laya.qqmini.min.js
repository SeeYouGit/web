"use strict";var _get=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(n):void 0},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}window.qqMiniGame=function(e,t){var i=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isLocalNativeFile",value:function(e){for(var t=0,i=s.nativefiles.length;t<i;t++)if(-1!=e.indexOf(s.nativefiles[t]))return!0;return!1}},{key:"getFileInfo",value:function(t){var i=t,n=e.fakeObj[i];return null==n?null:n}},{key:"read",value:function(i){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";n=""==l||-1==l.indexOf("http://")&&-1==l.indexOf("https://")?i:e.getFileNativePath(i),n=t.URL.getAdptedFilePath(n),e.fs.readFile({filePath:n,encoding:o,success:function(e){null!=a&&a.runWith([0,e])},fail:function(t){t&&""!=l?e.downFiles(l,o,a,l,r,s):null!=a&&a.runWith([1])}})}},{key:"downFiles",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];e.wxdown({url:t,success:function(s){200===s.statusCode?e.readFile(s.tempFilePath,i,n,o,a,l,r):403===s.statusCode?null!=n&&n.runWith([0,t]):null!=n&&n.runWith([1,s])},fail:function(e){null!=n&&n.runWith([1,e])}}).onProgressUpdate(function(e){null!=n&&n.runWith([2,e.progress])})}},{key:"readFile",value:function(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],!(arguments.length>6&&void 0!==arguments[6])||arguments[6]);i=t.URL.getAdptedFilePath(i),e.fs.readFile({filePath:i,encoding:n,success:function(t){(-1!=i.indexOf("http://")||-1!=i.indexOf("https://"))&&(s.autoCacheFile||l)?(null!=o&&o.runWith([0,t]),e.copyFile(i,a,null,n,r)):null!=o&&o.runWith([0,t])},fail:function(e){e&&null!=o&&o.runWith([1,e])}})}},{key:"downOtherFiles",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.wxdown({url:t,success:function(t){200===t.statusCode?(s.autoCacheFile||o)&&-1==n.indexOf("qlogo.cn")&&-1==n.indexOf(".php")?(null!=i&&i.runWith([0,t.tempFilePath]),e.copyFile(t.tempFilePath,n,null,"",a)):null!=i&&i.runWith([0,t.tempFilePath]):null!=i&&i.runWith([1,t])},fail:function(e){null!=i&&i.runWith([1,e])}})}},{key:"downLoadFile",value:function(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"utf8";window.navigator.userAgent.indexOf("MiniGame")<0?t.Laya.loader.load(i,o):n==t.Loader.IMAGE||n==t.Loader.SOUND?e.downOtherFiles(i,o,i,!0,!1):e.downFiles(i,a,o,i,!0,n,!1)}},{key:"copyFile",value:function(i,n,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=i.split("/"),u=r[r.length-1],d=n,c=e.getFileInfo(n),h=e.getFileNativePath(u);e.fakeObj[d]={md5:u,readyUrl:n,size:0,times:t.Browser.now(),encoding:a};var f=e.getCacheUseSize();c?c.readyUrl!=n?e.fs.getFileInfo({filePath:i,success:function(t){l&&f+4194304+t.size>=52428800&&(t.size>s.minClearSize&&(s.minClearSize=t.size),e.onClearCacheRes()),e.deleteFile(i,n,o,a,t.size)},fail:function(e){null!=o&&o.runWith([1,e])}}):null!=o&&o.runWith([0]):e.fs.getFileInfo({filePath:i,success:function(t){l&&f+4194304+t.size>=52428800&&(t.size>s.minClearSize&&(s.minClearSize=t.size),e.onClearCacheRes()),e.fs.copyFile({srcPath:i,destPath:h,success:function(i){e.onSaveFile(n,u,!0,a,o,t.size)},fail:function(e){null!=o&&o.runWith([1,e])}})},fail:function(e){null!=o&&o.runWith([1,e])}})}},{key:"onClearCacheRes",value:function(){var t=s.minClearSize,i=[];for(var n in e.filesListObj)"fileUsedSize"!=n&&i.push(e.filesListObj[n]);e.sortOn(i,"times",e.NUMERIC);for(var o=0,a=1,l=i.length;a<l;a++){var r=i[a];if(o>=t)break;o+=r.size,e.deleteFile("",r.readyUrl)}}},{key:"sortOn",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n==e.NUMERIC?t.sort(function(e,t){return e[i]-t[i]}):n==(e.NUMERIC|e.DESCENDING)?t.sort(function(e,t){return t[i]-e[i]}):t.sort(function(e,t){return e[i]-t[i]})}},{key:"getFileNativePath",value:function(t){return e.fileNativeDir+"/"+t}},{key:"deleteFile",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=e.getFileInfo(i),r=e.getFileNativePath(l.md5),s=""!=t;e.onSaveFile(i,t,s,o,n,a),e.fs.unlink({filePath:r,success:function(i){if(""!=t){var o=e.getFileNativePath(t);e.fs.copyFile({srcPath:t,destPath:o,success:function(e){},fail:function(e){null!=n&&n.runWith([1,e])}})}},fail:function(e){}})}},{key:"deleteAll",value:function(){var t=[];for(var i in e.filesListObj)"fileUsedSize"!=i&&t.push(e.filesListObj[i]);for(var n=1,o=t.length;n<o;n++){var a=t[n];e.deleteFile("",a.readyUrl)}e.filesListObj&&e.filesListObj.fileUsedSize&&(e.filesListObj.fileUsedSize=0),e.writeFilesList("",JSON.stringify({}),!1)}},{key:"onSaveFile",value:function(i,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=i;if(null==e.filesListObj.fileUsedSize&&(e.filesListObj.fileUsedSize=0),o){e.getFileNativePath(n);e.filesListObj[s]={md5:n,readyUrl:i,size:r,times:t.Browser.now(),encoding:a},e.filesListObj.fileUsedSize=parseInt(e.filesListObj.fileUsedSize)+r,e.writeFilesList(s,JSON.stringify(e.filesListObj),!0),null!=l&&l.runWith([0])}else if(e.filesListObj[s]){var u=parseInt(e.filesListObj[s].size);e.filesListObj.fileUsedSize=parseInt(e.filesListObj.fileUsedSize)-u,delete e.filesListObj[s],e.writeFilesList(s,JSON.stringify(e.filesListObj),!1),null!=l&&l.runWith([0])}}},{key:"writeFilesList",value:function(t,i,n){var o=e.fileNativeDir+"/"+e.fileListName;e.fs.writeFile({filePath:o,encoding:"utf8",data:i,success:function(e){},fail:function(e){}}),!s.isZiYu&&s.isPosMsgYu&&s.window.qq.postMessage({url:t,data:e.filesListObj[t],isLoad:"filenative",isAdd:n})}},{key:"getCacheUseSize",value:function(){return e.filesListObj&&e.filesListObj.fileUsedSize?e.filesListObj.fileUsedSize:0}},{key:"existDir",value:function(t,i){e.fs.mkdir({dirPath:t,success:function(e){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(t){-1!=t.errMsg.indexOf("file already exists")?e.readSync(e.fileListName,"utf8",i):null!=i&&i.runWith([1,t])}})}},{key:"readSync",value:function(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],e.getFileNativePath(t));try{i=e.fs.readFileSync(a,n),null!=o&&o.runWith([0,{data:i}])}catch(e){null!=o&&o.runWith([1])}}},{key:"setNativeFileDir",value:function(t){e.fileNativeDir=s.window.qq.env.USER_DATA_PATH+t}}]),e}();i.fs=window.qq.getFileSystemManager(),i.wxdown=window.qq.downloadFile,i.filesListObj={},i.fakeObj={},i.fileListName="layaairfiles.txt",i.ziyuFileData={},i.ziyuFileTextureData={},i.loadPath="",i.DESCENDING=2,i.NUMERIC=16;var n=function(e){function i(e,t){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n._audio=e,n._miniSound=t,n._onEnd=i.bindToThis(n.__onEnd,n),e.onEnded(n._onEnd),n}return _inherits(i,t.SoundChannel),_createClass(i,[{key:"__onEnd",value:function(){if(1==this.loops)return this.completeHandler&&(t.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(t.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}},{key:"play",value:function(){this.isStopped=!1,t.SoundManager.addChannel(this),this._audio.play()}},{key:"stop",value:function(){this.isStopped=!0,t.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this._audio.offEnded(null),this._miniSound.dispose(),this._audio=null,this._miniSound=null,this._onEnd=null))}},{key:"pause",value:function(){this.isStopped=!0,this._audio.pause()}},{key:"resume",value:function(){this._audio&&(this.isStopped=!1,t.SoundManager.addChannel(this),this._audio.play())}},{key:"startTime",set:function(e){this._audio&&(this._audio.startTime=e)}},{key:"autoplay",set:function(e){this._audio.autoplay=e},get:function(){return this._audio.autoplay}},{key:"position",get:function(){return this._audio?this._audio.currentTime:0}},{key:"duration",get:function(){return this._audio?this._audio.duration:0}},{key:"loop",get:function(){return this._audio.loop},set:function(e){this._audio.loop=e}},{key:"volume",set:function(e){this._audio&&(this._audio.volume=e)},get:function(){return this._audio?this._audio.volume:1}}],[{key:"bindToThis",value:function(e,t){return e.bind(t)}}]),i}(),o=function(e){function o(){_classCallCheck(this,o);var e=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return e.loaded=!1,e}return _inherits(o,t.EventDispatcher),_createClass(o,[{key:"load",value:function(e){if(i.isLocalNativeFile(e)){if(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))if(""!=i.loadPath)e=e.split(i.loadPath)[1];else{var n=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath;""!=n&&(e=e.split(n)[1])}}else e=t.URL.formatURL(e);if(this.url=e,this.readyUrl=e,o._audioCache[this.readyUrl])this.event(t.Event.COMPLETE);else if(s.autoCacheFile&&i.getFileInfo(e))this.onDownLoadCallBack(e,0);else if(s.autoCacheFile)if(i.isLocalNativeFile(e)){var a=e;if(""!=(n=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath)&&(e=e.split(n)[1]),e||(e=a),s.subNativeFiles&&0==s.subNativeheads.length)for(var l in s.subNativeFiles){var r=s.subNativeFiles[l];s.subNativeheads=s.subNativeheads.concat(r);for(var u=0;u<r.length;u++)s.subMaps[r[u]]=l+"/"+r[u]}if(s.subNativeFiles&&-1!=e.indexOf("/")){var d=e.split("/")[0]+"/";if(d&&-1!=s.subNativeheads.indexOf(d)){var c=s.subMaps[d];e=e.replace(d,c)}}this.onDownLoadCallBack(e,0)}else!i.isLocalNativeFile(e)&&-1==e.indexOf("http://")&&-1==e.indexOf("https://")||-1!=e.indexOf(s.window.qq.env.USER_DATA_PATH)?this.onDownLoadCallBack(e,0):i.downOtherFiles(encodeURI(e),t.Handler.create(this,this.onDownLoadCallBack,[e]),e);else this.onDownLoadCallBack(e,0)}},{key:"onDownLoadCallBack",value:function(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)this.event(t.Event.ERROR);else{var l;if(s.autoCacheFile){if(a)l=a;else if(i.isLocalNativeFile(e)){var r=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,u=e;""==r||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(l=e.split(r)[1]),l||(l=u)}else{var d=i.getFileInfo(e);if(d&&d.md5){var c=d.md5;l=i.getFileNativePath(c)}else l=e}this._sound=o._createSound(),this._sound.src=this.url=l}else this._sound=o._createSound(),this._sound.src=this.url=e;this._sound.onCanplay(o.bindToThis(this.onCanPlay,this)),this._sound.onError(o.bindToThis(this.onError,this))}}},{key:"onError",value:function(e){try{console.log("-----1---------------minisound-----id:"+o._id),console.log(e)}catch(e){console.log("-----2---------------minisound-----id:"+o._id),console.log(e)}this.event(t.Event.ERROR),this._sound.offError(null)}},{key:"onCanPlay",value:function(){this.loaded=!0,this.event(t.Event.COMPLETE),this._sound.offCanplay(null)}},{key:"play",value:function(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.url==t.SoundManager._bgMusic?(o._musicAudio||(o._musicAudio=o._createSound()),e=o._musicAudio):e=o._audioCache[this.readyUrl]?o._audioCache[this.readyUrl]._sound:o._createSound(),!e)return null;if(s.autoCacheFile&&i.getFileInfo(this.url)){var r=i.getFileInfo(this.url).md5;e.src=this.url=i.getFileNativePath(r)}else e.src=encodeURI(this.url);var u=new n(e,this);return u.url=this.url,u.loops=l,u.loop=0===l,u.startTime=a,u.play(),t.SoundManager.addChannel(u),u}},{key:"dispose",value:function(){var e=o._audioCache[this.readyUrl];e&&(e.src="",e._sound&&(e._sound.destroy(),e._sound=null,e=null),delete o._audioCache[this.readyUrl]),this._sound&&(this._sound.destroy(),this._sound=null,this.readyUrl=this.url=null)}},{key:"duration",get:function(){return this._sound.duration}}],[{key:"_createSound",value:function(){return o._id++,s.window.qq.createInnerAudioContext()}},{key:"bindToThis",value:function(e,t){return e.bind(t)}}]),o}();o._id=0,o._audioCache={};var a=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"_createInputElement",value:function(){t.Input._initInput(t.Input.area=t.Browser.createElement("textarea")),t.Input._initInput(t.Input.input=t.Browser.createElement("input")),t.Input.inputContainer=t.Browser.createElement("div"),t.Input.inputContainer.style.position="absolute",t.Input.inputContainer.style.zIndex=1e5,t.Browser.container.appendChild(t.Input.inputContainer),t.Laya.stage.on("resize",null,e._onStageResize),s.window.qq.onWindowResize&&s.window.qq.onWindowResize(function(e){}),t.SoundManager._soundClass=o,t.SoundManager._musicClass=o;var i=s.systemInfo.model,n=s.systemInfo.system;-1!=i.indexOf("iPhone")&&(t.Browser.onIPhone=!0,t.Browser.onIOS=!0,t.Browser.onIPad=!0,t.Browser.onAndroid=!1),-1==n.indexOf("Android")&&-1==n.indexOf("Adr")||(t.Browser.onAndroid=!0,t.Browser.onIPhone=!1,t.Browser.onIOS=!1,t.Browser.onIPad=!1)}},{key:"_onStageResize",value:function(){t.Laya.stage._canvasTransform.identity().scale(t.Browser.width/t.Render.canvas.width/t.Browser.pixelRatio,t.Browser.height/t.Render.canvas.height/t.Browser.pixelRatio)}},{key:"wxinputFocus",value:function(i){var n=t.Input.inputElement.target;n&&!n.editable||(s.window.qq.offKeyboardConfirm(),s.window.qq.offKeyboardInput(),s.window.qq.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:n.confirmType||"done",success:function(e){},fail:function(e){}}),s.window.qq.onKeyboardConfirm(function(i){var o=i?i.value:"";n._restrictPattern&&(o=o.replace(/\u2006|\x27/g,""),n._restrictPattern.test(o)&&(o=o.replace(n._restrictPattern,""))),n.text=o,n.event(t.Event.INPUT),e.inputEnter(),n.event("confirm")}),s.window.qq.onKeyboardInput(function(i){var o=i?i.value:"";n.multiline||-1==o.indexOf("\n")?(n._restrictPattern&&(o=o.replace(/\u2006|\x27/g,""),n._restrictPattern.test(o)&&(o=o.replace(n._restrictPattern,""))),n.text=o,n.event(t.Event.INPUT)):e.inputEnter()}))}},{key:"inputEnter",value:function(){t.Input.inputElement.target.focus=!1}},{key:"wxinputblur",value:function(){e.hideKeyboard()}},{key:"hideKeyboard",value:function(){s.window.qq.offKeyboardConfirm(),s.window.qq.offKeyboardInput(),s.window.qq.hideKeyboard({success:function(e){console.log("隐藏键盘")},fail:function(e){console.log("隐藏键盘出错:"+(e?e.errMsg:""))}})}}]),e}(),l=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))}return _inherits(n,t.EventDispatcher),_createClass(n,[{key:"_loadResourceFilter",value:function(e,o){if(-1==o.indexOf(s.window.qq.env.USER_DATA_PATH)&&(-1!=o.indexOf("http://")||-1!=o.indexOf("https://")))if(""!=i.loadPath)o=o.split(i.loadPath)[1];else{var a=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,l=o;""!=a&&(o=o.split(a)[1]),o||(o=l)}if(s.subNativeFiles&&0==s.subNativeheads.length)for(var r in s.subNativeFiles){var u=s.subNativeFiles[r];s.subNativeheads=s.subNativeheads.concat(u);for(var d=0;d<u.length;d++)s.subMaps[u[d]]=r+"/"+u[d]}if(s.subNativeFiles&&-1!=o.indexOf("/")){var c=o.split("/")[0]+"/";if(c&&-1!=s.subNativeheads.indexOf(c)){var h=s.subMaps[c];o=o.replace(c,h)}}switch(e){case t.Loader.IMAGE:case"htmlimage":case"nativeimage":n._transformImgUrl(o,e,this);break;case t.Loader.SOUND:this._loadSound(o);break;default:this._loadResource(e,o)}}},{key:"_loadSound",value:function(e){var o;if(i.isLocalNativeFile(e)){var a=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,l=e;""==a||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(o=e.split(a)[1]),o||(o=l),n.onDownLoadCallBack(e,this,0)}else{var r=t.URL.formatURL(e);!i.isLocalNativeFile(e)&&-1==r.indexOf("http://")&&-1==r.indexOf("https://")||-1!=r.indexOf(s.window.qq.env.USER_DATA_PATH)?n.onDownLoadCallBack(e,this,0):i.downOtherFiles(encodeURI(r),t.Handler.create(n,n.onDownLoadCallBack,[r,this]),r)}}},{key:"_loadHttpRequestWhat",value:function(e,o){var a=s.getUrlEncode(e,o);if(t.Loader.preLoadedMap[e])this.onLoaded(t.Loader.preLoadedMap[e]);else{var l=t.URL.formatURL(e);if(i.isLocalNativeFile(e)||i.getFileInfo(l)||-1!=e.indexOf(s.window.qq.env.USER_DATA_PATH)||-1==l.indexOf("http://")&&-1==l.indexOf("https://")||s.AutoCacheDownFile){var r=i.getFileInfo(t.URL.formatURL(e));r?(r.encoding=null==r.encoding?"utf8":r.encoding,i.readFile(i.getFileNativePath(r.md5),a,new t.Handler(n,n.onReadNativeCallBack,[e,o,this]),e)):"image"==this.type||"htmlimage"==this.type?this._transformUrl(e,o):o!=t.Loader.IMAGE&&(-1==l.indexOf("http://")&&-1==l.indexOf("https://")||i.isLocalNativeFile(e))?i.readFile(e,a,new t.Handler(n,n.onReadNativeCallBack,[e,o,this]),e):i.downFiles(encodeURI(l),a,new t.Handler(n,n.onReadNativeCallBack,[e,o,this]),l,!0)}else this._loadHttpRequest(l,o,this,this.onLoaded,this,this.onProgress,this,this.onError)}}}],[{key:"onDownLoadCallBack",value:function(e,n,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(o)n.event(t.Event.ERROR,"Load sound failed");else{var l;if(s.autoCacheFile)if(a)l=a;else if(i.isLocalNativeFile(e)){var r=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,u=e;""==r||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(l=e.split(r)[1]),l||(l=u)}else{var d=i.getFileInfo(e);if(d&&d.md5){var c=d.md5;l=i.getFileNativePath(c)}else l=e}e=l;var h=new t.SoundManager._soundClass;h.load(encodeURI(e)),n.onLoaded(h)}}},{key:"bindToThis",value:function(e,t){return e.bind(t)}},{key:"onReadNativeCallBack",value:function(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;a?1==a&&o._loadHttpRequest(e,n,o,o.onLoaded,o,o.onProgress,o,o.onError):(i=n==t.Loader.JSON||n==t.Loader.ATLAS||n==t.Loader.PREFAB||n==t.Loader.PLF?s.getJson(l.data):n==t.Loader.XML?t.Utils.parseXMLFromString(l.data):l.data,!s.isZiYu&&s.isPosMsgYu&&n!=t.Loader.BUFFER&&s.window.qq.postMessage({url:e,data:i,isLoad:"filedata"}),o.onLoaded(i))}},{key:"_transformImgUrl",value:function(e,o,a){if(s.isZiYu)a._loadImage(e,!1);else if(i.isLocalNativeFile(e))a._loadImage(e,!1);else if(i.isLocalNativeFile(e)||i.getFileInfo(t.URL.formatURL(e)))a._loadImage(e);else{var l=t.URL.formatURL(e);-1!=e.indexOf(s.window.qq.env.USER_DATA_PATH)||-1==l.indexOf("http://")&&-1==l.indexOf("https://")?a._loadImage(e,!1):s.isZiYu?a._loadImage(e,!1):i.downOtherFiles(encodeURI(l),new t.Handler(n,n.onDownImgCallBack,[e,a]),l)}}},{key:"onDownImgCallBack",value:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";i?t.onError(null):n.onCreateImage(e,t,!1,o)}},{key:"onCreateImage",value:function(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(s.autoCacheFile)if(a)if(s.isZiYu){var r=t.URL.formatURL(e);o=i.ziyuFileTextureData[r]?i.ziyuFileTextureData[r]:e}else o=e;else if(""!=l)o=l;else{var u=i.getFileInfo(e).md5;o=i.getFileNativePath(u)}else o=a?e:l;n._loadImage(o,!1)}}]),n}(),r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"__init__",value:function(){e.items=e}},{key:"setItem",value:function(e,t){try{s.window.qq.setStorageSync(e,t)}catch(i){s.window.qq.setStorage({key:e,data:t})}}},{key:"getItem",value:function(e){return s.window.qq.getStorageSync(e)}},{key:"setJSON",value:function(t,i){e.setItem(t,i)}},{key:"getJSON",value:function(t){return e.getItem(t)}},{key:"removeItem",value:function(e){s.window.qq.removeStorageSync(e)}},{key:"clear",value:function(){s.window.qq.clearStorageSync()}},{key:"getStorageInfoSync",value:function(){try{var e=s.window.qq.getStorageInfoSync();return console.log(e.keys),console.log(e.currentSize),console.log(e.limitSize),e}catch(e){}return null}}]),e}();r.support=!0;var s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getJson",value:function(e){return JSON.parse(e)}},{key:"enable",value:function(){e.init(t.Laya.isWXPosMsg,t.Laya.isWXOpenDataContext)}},{key:"init",value:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e._inited||(e._inited=!0,e.window=window,e.window.hasOwnProperty("qq")&&(e.window.navigator.userAgent.indexOf("MiniGame")<0||(e.isZiYu=o,e.isPosMsgYu=n,e.EnvConfig={},e.isZiYu||(i.setNativeFileDir("/layaairGame"),i.existDir(i.fileNativeDir,t.Handler.create(e,e.onMkdirCallBack))),e.systemInfo=e.window.qq.getSystemInfoSync(),e.window.focus=function(){},t.Laya._getUrlPath=function(){return""},e.window.logtime=function(e){},e.window.alertTimeLog=function(e){},e.window.resetShareInfo=function(){},e.window.CanvasRenderingContext2D=function(){},e.window.CanvasRenderingContext2D.prototype=e.window.qq.createCanvas().getContext("2d").__proto__,e.window.document.body.appendChild=function(){},e.EnvConfig.pixelRatioInt=0,t.Browser._pixelRatio=e.pixelRatio(),e._preCreateElement=t.Browser.createElement,t.Browser.createElement=e.createElement,t.RunDriver.createShaderCondition=e.createShaderCondition,t.Utils.parseXMLFromString=e.parseXMLFromString,t.Input._createInputElement=a._createInputElement,t.Loader.prototype._loadResourceFilter=l.prototype._loadResourceFilter,t.Loader.prototype._loadSound=l.prototype._loadSound,t.Loader.prototype._loadHttpRequestWhat=l.prototype._loadHttpRequestWhat,t.LocalStorage._baseClass=r,r.__init__(),t.Config.useRetinalCanvas=!0,e.window.qq.onMessage&&e.window.qq.onMessage(e._onMessage))))}},{key:"_onMessage",value:function(e){switch(e.type){case"changeMatrix":t.Laya.stage.transform.identity(),t.Laya.stage._width=e.w,t.Laya.stage._height=e.h,t.Laya.stage._canvasTransform=new t.Matrix(e.a,e.b,e.c,e.d,e.tx,e.ty);break;case"display":t.Laya.stage.frameRate=e.rate||t.Stage.FRAME_FAST;break;case"undisplay":t.Laya.stage.frameRate=t.Stage.FRAME_SLEEP}"opendatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata,i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl):"openJsondatacontext"==e.isLoad?e.url&&(i.ziyuFileData[e.url]=e.atlasdata):"openJsondatacontextPic"==e.isLoad&&(i.ziyuFileTextureData[e.imgReadyUrl]=e.imgNativeUrl)}},{key:"getUrlEncode",value:function(e,t){return"arraybuffer"==t?"":"utf8"}},{key:"downLoadFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"utf8";i.getFileInfo(e)?null!=n&&n.runWith([0]):i.downLoadFile(e,t,n,o)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i.deleteFile("",e,t,"",0)}},{key:"removeAll",value:function(){i.deleteAll()}},{key:"hasNativeFile",value:function(e){return i.isLocalNativeFile(e)}},{key:"getFileInfo",value:function(e){return i.getFileInfo(e)}},{key:"getFileList",value:function(){return i.filesListObj}},{key:"exitMiniProgram",value:function(){e.window.wx.exitMiniProgram()}},{key:"onMkdirCallBack",value:function(e,t){e||(i.filesListObj=JSON.parse(t.data)),i.fakeObj=i.filesListObj}},{key:"pixelRatio",value:function(){if(!e.EnvConfig.pixelRatioInt)try{return e.EnvConfig.pixelRatioInt=e.systemInfo.pixelRatio,e.systemInfo.pixelRatio}catch(e){}return e.EnvConfig.pixelRatioInt}},{key:"createElement",value:function(t){var i;if("canvas"==t)return 1==e.idx?e.isZiYu?(i=e.window.sharedCanvas).style={}:i=e.window.canvas:i=e.window.qq.createCanvas(),e.idx++,i;if("textarea"==t||"input"==t)return e.onCreateInput(t);if("div"==t){var n=e._preCreateElement(t);return n.contains=function(e){return null},n.removeChild=function(e){},n}return e._preCreateElement(t)}},{key:"onCreateInput",value:function(t){var i=e._preCreateElement(t);return i.focus=a.wxinputFocus,i.blur=a.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(e){},i.setType=function(e){},i.setFontFace=function(e){},i.addEventListener=function(e){},i.contains=function(e){return null},i.removeChild=function(e){},i}},{key:"createShaderCondition",value:function(e){return function(){return this[e.replace("this.","")]}}},{key:"sendAtlasToOpenDataContext",value:function(i){if(!e.isZiYu){var n=t.Loader.getRes(t.URL.formatURL(i));if(!n)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";n.meta.image.split(",");if(n.meta&&n.meta.image)for(var o=n.meta.image.split(","),a=i.indexOf("/")>=0?"/":"\\",l=i.lastIndexOf(a),r=l>=0?i.substr(0,l+1):"",s=0,u=o.length;s<u;s++)o[s]=r+o[s];else o=[i.replace(".json",".png")];for(s=0;s<o.length;s++){var d=o[s];e.postInfoToContext(t.Laya.URL.formatURL(i),t.Laya.URL.formatURL(d),n)}}}},{key:"postInfoToContext",value:function(n,o,a){var l={frames:a.frames,meta:a.meta},r=o,s=i.getFileInfo(t.URL.formatURL(o));if(s)var u=s.md5,d=i.getFileNativePath(u);else d=r;if(!d)throw"获取图集的磁盘url路径不存在！";e.window.qq.postMessage({url:n,atlasdata:l,imgNativeUrl:d,imgReadyUrl:r,isLoad:"opendatacontext"})}},{key:"sendSinglePicToOpenDataContext",value:function(n){var o=t.URL.formatURL(n),a=i.getFileInfo(o);if(a){var l=a.md5,r=i.getFileNativePath(l);n=o}else r=n;if(!r)throw"获取图集的磁盘url路径不存在！";n=t.Laya.URL.formatURL(n),e.window.qq.postMessage({url:n,imgNativeUrl:r,imgReadyUrl:n,isLoad:"openJsondatacontextPic"})}},{key:"sendJsonDataToDataContext",value:function(i){if(!e.isZiYu){i=t.Laya.URL.formatURL(i);var n=t.Loader.getRes(i);if(!n)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";e.window.qq.postMessage({url:i,atlasdata:n,isLoad:"openJsondatacontext"})}}}]),e}();s._inited=!1,s.autoCacheFile=!0,s.minClearSize=5242880,s.nativefiles=["layaNativeDir","wxlocal"],s.subNativeFiles=[],s.subNativeheads=[],s.subMaps=[],s.AutoCacheDownFile=!1,s.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new s.window.Parser.DOMParser).parseFromString(e,"text/xml")}catch(e){throw"需要引入xml解析库文件"}return t},s.idx=1;var u=function(e){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this))}return _inherits(i,t.EventDispatcher),_createClass(i,[{key:"on",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"on",this).call(this,e,t,n,o),i.startListen(this.onDeviceOrientationChange),this}},{key:"off",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.hasListener(e)||i.stopListen(),_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"off",this).call(this,e,t,n,o)}}],[{key:"__init__",value:function(){try{var e;if(!(e=t.Accelerator))return;e.prototype.on=i.prototype.on,e.prototype.off=i.prototype.off}catch(e){}}},{key:"startListen",value:function(e){if(i._callBack=e,!i._isListening){i._isListening=!0;try{s.window.qq.onAccelerometerChange(i.onAccelerometerChange)}catch(e){}}}},{key:"stopListen",value:function(){i._isListening=!1;try{s.window.qq.stopAccelerometer({})}catch(e){}}},{key:"onAccelerometerChange",value:function(e){var t;(t={}).acceleration=e,t.accelerationIncludingGravity=e,t.rotationRate={},null!=i._callBack&&i._callBack(t)}}]),i}();u._isListening=!1;var d=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"_loadImage",value:function(n){if(s.isZiYu)e.onCreateImage(n,this,!0);else{var o;if(i.isLocalNativeFile(n)){if(-1==n.indexOf(s.window.qq.env.USER_DATA_PATH)&&(-1!=n.indexOf("http://")||-1!=n.indexOf("https://")))if(""!=i.loadPath)n=n.split(i.loadPath)[1];else{var a=""!=t.URL.rootPath?t.URL.rootPath:t.URL._basePath,l=n;""!=a&&(n=n.split(a)[1]),n||(n=l)}if(s.subNativeFiles&&0==s.subNativeheads.length)for(var r in s.subNativeFiles){var u=s.subNativeFiles[r];s.subNativeheads=s.subNativeheads.concat(u);for(var d=0;d<u.length;d++)s.subMaps[u[d]]=r+"/"+u[d]}if(s.subNativeFiles&&-1!=n.indexOf("/")){var c=n.split("/")[0]+"/";if(c&&-1!=s.subNativeheads.indexOf(c)){var h=s.subMaps[c];n=n.replace(c,h)}}}else o=!0,n=t.URL.formatURL(n);i.getFileInfo(n)?e.onCreateImage(n,this,!o):-1!=n.indexOf(s.window.qq.env.USER_DATA_PATH)||-1==n.indexOf("http://")&&-1==n.indexOf("https://")?e.onCreateImage(n,this,!0):s.isZiYu?e.onCreateImage(n,this,!0):i.downOtherFiles(encodeURI(n),new t.Handler(e,e.onDownImgCallBack,[n,this]),n)}}}],[{key:"onDownImgCallBack",value:function(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";n?i.onError(null):e.onCreateImage(t,i,!1,o)}},{key:"onCreateImage",value:function(e,n){var o,a,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(s.autoCacheFile)if(l)if(s.isZiYu){var u=t.URL.formatURL(e);o=i.ziyuFileTextureData[u]?i.ziyuFileTextureData[u]:e}else o=e;else if(""!=r)o=r;else{var d=i.getFileInfo(e).md5;o=i.getFileNativePath(d)}else o=l?e:r;function c(){var e=n._imgCache[o];e&&(e.onload=null,e.onerror=null,delete n._imgCache[o])}null==n._imgCache&&(n._imgCache={});var h=function(){c(),delete i.fakeObj[e],delete i.filesListObj[e],n.event(t.Event.ERROR,"Load image failed")};if("nativeimage"==n._type){var f=function(){c(),n.onLoaded(a)};(a=new t.Browser.window.Image).crossOrigin="",a.onload=f,a.onerror=h,a.src=o,n._imgCache[o]=a}else{var v=new t.Browser.window.Image;f=function(){(a=t.HTMLImage.create(v.width,v.height)).loadImageSource(v,!0),a._setCreateURL(o),c(),n.onLoaded(a)},v.crossOrigin="",v.onload=f,v.onerror=h,v.src=o,n._imgCache[o]=v}}}]),e}(),c=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"__init__",value:function(){s.window.navigator.geolocation.getCurrentPosition=e.getCurrentPosition,s.window.navigator.geolocation.watchPosition=e.watchPosition,s.window.navigator.geolocation.clearWatch=e.clearWatch}},{key:"getCurrentPosition",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;arguments.length>2&&void 0!==arguments[2]&&arguments[2];(e={}).success=function(e){null!=t&&t(e)},e.fail=i,s.window.qq.getLocation(e)}},{key:"watchPosition",value:function(){var i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e._curID++,(i={}).success=n,i.error=o,e._watchDic[e._curID]=i,t.Laya.systemTimer.loop(1e3,null,e._myLoop),e._curID}},{key:"clearWatch",value:function(i){delete e._watchDic[i],e._hasWatch()||t.Laya.systemTimer.clear(null,e._myLoop)}},{key:"_hasWatch",value:function(){var t;for(t in e._watchDic)if(e._watchDic[t])return!0;return!1}},{key:"_myLoop",value:function(){e.getCurrentPosition(e._mySuccess,e._myError)}},{key:"_mySuccess",value:function(i){var n,o={};for(n in o.coords=i,o.timestamp=t.Browser.now(),e._watchDic)e._watchDic[n].success&&e._watchDic[n].success(o)}},{key:"_myError",value:function(t){var i;for(i in e._watchDic)e._watchDic[i].error&&e._watchDic[i].error(t)}}]),e}();c._watchDic={},c._curID=0;var h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240;_classCallCheck(this,e),this.videoend=!1,this.videourl="",this.videoElement=s.window.qq.createVideo({width:t,height:i,autoplay:!0})}return _createClass(e,[{key:"on",value:function(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)}},{key:"onTimeUpdateFunc",value:function(e){this.position=e.position,this._duration=e.duration}},{key:"onPlayFunction",value:function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()}},{key:"onEndedFunction",value:function(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())}},{key:"off",value:function(e,t,i){"loadedmetadata"==e?(this.onPlayFunc=i.bind(t),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=i.bind(t),this.videoElement.offEnded=this.onEndedFunction.bind(this))}},{key:"load",value:function(e){this.videoElement&&(this.videoElement.src=e)}},{key:"play",value:function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())}},{key:"pause",value:function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())}},{key:"size",value:function(e,t){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=t)}},{key:"destroy",value:function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null}},{key:"reload",value:function(){this.videoElement&&(this.videoElement.src=this.videourl)}},{key:"duration",get:function(){return this._duration}},{key:"currentTime",get:function(){return this.videoElement?this.videoElement.initialTime:0},set:function(e){this.videoElement&&(this.videoElement.initialTime=e)}},{key:"videoWidth",get:function(){return this.videoElement?this.videoElement.width:0}},{key:"videoHeight",get:function(){return this.videoElement?this.videoElement.height:0}},{key:"ended",get:function(){return this.videoend}},{key:"loop",get:function(){return!!this.videoElement&&this.videoElement.loop},set:function(e){this.videoElement&&(this.videoElement.loop=e)}},{key:"playbackRate",get:function(){return this.videoElement?this.videoElement.playbackRate:0},set:function(e){this.videoElement&&(this.videoElement.playbackRate=e)}},{key:"muted",get:function(){return!!this.videoElement&&this.videoElement.muted},set:function(e){this.videoElement&&(this.videoElement.muted=e)}},{key:"paused",get:function(){return!!this.videoElement&&this.videoElement.paused}},{key:"x",get:function(){return this.videoElement?this.videoElement.x:0},set:function(e){this.videoElement&&(this.videoElement.x=e)}},{key:"y",get:function(){return this.videoElement?this.videoElement.y:0},set:function(e){this.videoElement&&(this.videoElement.y=e)}},{key:"currentSrc",get:function(){return this.videoElement.src}}],[{key:"__init__",value:function(){}}]),e}();e.MiniAccelerator=u,e.MiniFileMgr=i,e.MiniImage=d,e.MiniInput=a,e.MiniLoader=l,e.MiniLocalStorage=r,e.MiniLocation=c,e.MiniSound=o,e.MiniSoundChannel=n,e.MiniVideo=h,e.QQMiniAdapter=s};